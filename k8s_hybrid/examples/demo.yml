---
additionalArguments:
  - "--certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare"
  - "--certificatesresolvers.cloudflare.acme.email=my@email.address"
  - "--certificatesresolvers.cloudflare.acme.dnschallenge.resolvers=1.1.1.1"
  - "--certificatesresolvers.cloudflare.acme.storage=/ssl-certs/acme-cloudflare.json"
deployment:
  initContainers:
    - command:
        - sh
        - "-c"
        - "touch /ssl-certs/acme-cloudflare.json; chown 65532 /ssl-certs/acme-cloudflare.json; chmod -v 600 /ssl-certs/acme-cloudflare.json"
      image: busybox:1.36.1
      name: volume-permissions
      volumeMounts:
        - mountPath: /ssl-certs
          name: ssl-certs
  kind: Deployment
env:
  - name: CF_DNS_API_TOKEN
    valueFrom:
      secretKeyRef:
        key: apiKey
        name: cloudflare-credentials
  - name: CF_ZONE_API_TOKEN
    valueFrom:
      secretKeyRef:
        key: apiKey
        name: cloudflare-credentials
ingressClass:
  enabled: true
  isDefaultClass: true
  name: ""
ingressRoute:
  dashboard:
    enabled: true
    entryPoints:
      - web
      - websecure
    matchRule: Host(`proxy.kube.mydomain.com`) || Host(`proxy.mydomain.com`)
    services:
      - kind: TraefikService
        name: api@internal
    tls:
      certResolver: cloudflare
persistence:
  accessMode: ReadWriteOnce
  enabled: true
  name: ssl-certs
  path: /ssl-certs
  size: 1Gi
ports:
  web:
    expose:
      default: true
    exposedPort: 80
    forwardedHeaders:
      insecure: true
      trustedIPs:
        - 0.0.0.0/0
    port: 8000
    protocol: TCP
    proxyProtocol:
      insecure: true
      trustedIPs:
        - 0.0.0.0/0
    redirectTo:
      port: websecure
  websecure:
    allowACMEByPass: false
    expose:
      default: true
    exposedPort: 443
    forwardedHeaders:
      insecure: true
      trustedIPs:
        - 0.0.0.0/0
    tls:
      certResolver: cloudflare
      domains:
        - main: mydomain.com
          sans:
            - "*.mydomain.com"
      enabled: true
providers:
  kubernetesCRD:
    allowCrossNamespace: true
    allowEmptyServices: true
    allowExternalNameServices: true
    enabled: true
    nativeLBByDefault: false
  kubernetesGateway:
    enabled: false
  kubernetesIngress:
    allowEmptyServices: true
    allowExternalNameServices: true
service:
  enabled: true
  single: true
  type: LoadBalancer
